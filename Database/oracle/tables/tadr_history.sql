ALTER TABLE ASU.TADR_HISTORY
 DROP PRIMARY KEY CASCADE
/

DROP TABLE ASU.TADR_HISTORY CASCADE CONSTRAINTS
/

--
-- TADR_HISTORY  (Table) 
--
CREATE TABLE ASU.TADR_HISTORY
(
  FK_ID          NUMBER(15)                     NOT NULL,
  FK_COUNTRYID   NUMBER(15)                     DEFAULT -1,
  FK_REGIONID    NUMBER(15)                     DEFAULT -1,
  FK_TOWNID      NUMBER(15)                     DEFAULT -1,
  FK_STREETID    NUMBER(15)                     DEFAULT -1,
  FK_PACID       NUMBER(15)                     DEFAULT -1                    NOT NULL,
  FK_TYPE        NUMBER(15)                     DEFAULT -1                    NOT NULL,
  FL_AS_ANOTHER  NUMBER                         DEFAULT 0,
  FK_RAIONID     NUMBER(15)                     DEFAULT -1,
  FC_ADR         VARCHAR2(230 BYTE),
  FK_INTOWNID    NUMBER(15)                     DEFAULT -1,
  FC_HOUSE       VARCHAR2(10 BYTE),
  FC_KORPUS      VARCHAR2(4 BYTE),
  FC_KVARTIRA    VARCHAR2(4 BYTE),
  FK_KLADR       NUMBER,
  FD_DATE        DATE,
  FK_APPSOTRID   NUMBER,
  FK_ADRES       NUMBER                         NOT NULL
)
TABLESPACE USR
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          20368K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOLOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING
/

COMMENT ON TABLE ASU.TADR_HISTORY IS 'ТАБЛИЦА ИСТОРИИ СМЕНЫ АДРЕСОВ ЛЮДЕЙ
AUTHOR:Kudzoev 2010.04.23'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_ID IS 'SEQUENCE=[SEQ_TADRESS]'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_COUNTRYID IS 'TCOUNTRY.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_REGIONID IS 'TREGION.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_TOWNID IS 'TTOWN.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_STREETID IS 'TSTREET.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_PACID IS 'TPEOPLES.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_TYPE IS 'TADRTYPRE.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FL_AS_ANOTHER IS 'нет данных'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_RAIONID IS 'TRAION.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FC_ADR IS 'почтовый адрес'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_INTOWNID IS 'TINTOWN.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FC_HOUSE IS 'номер дома'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FC_KORPUS IS 'номер корпуса'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FC_KVARTIRA IS 'номер квартиры'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_KLADR IS 'Код КЛАДР TKLADR.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FD_DATE IS 'Дата изменения адреса'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_APPSOTRID IS 'Сотрудник, изменивший адрес LOGIN.TAPPSOTR.FK_ID'
/

COMMENT ON COLUMN ASU.TADR_HISTORY.FK_ADRES IS 'Ссылка на TADRESS'
/


--
-- TADR_HIST_BY_ID  (Index) 
--
--  Dependencies: 
--   TADR_HISTORY (Table)
--
CREATE UNIQUE INDEX ASU.TADR_HIST_BY_ID ON ASU.TADR_HISTORY
(FK_ID)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          3328K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- TADR_HIST_BY_PACID  (Index) 
--
--  Dependencies: 
--   TADR_HISTORY (Table)
--
CREATE INDEX ASU.TADR_HIST_BY_PACID ON ASU.TADR_HISTORY
(FK_PACID)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          3872K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- TADR_HISTORY_BI  (Trigger) 
--
--  Dependencies: 
--   TADR_HISTORY (Table)
--
CREATE OR REPLACE TRIGGER ASU."TADR_HISTORY_BI" 
BEFORE INSERT
ON ASU.TADR_HISTORY REFERENCING NEW AS New OLD AS Old
FOR EACH ROW
BEGIN
   SELECT SEQ_TADR_HISTORY.NEXTVAL INTO :New.FK_ID FROM DUAL;
END ;
/
SHOW ERRORS;


-- 
-- Non Foreign Key Constraints for Table TADR_HISTORY 
-- 
ALTER TABLE ASU.TADR_HISTORY ADD (
  CONSTRAINT TADR_HIST_BY_ID
 PRIMARY KEY
 (FK_ID)
    USING INDEX 
    TABLESPACE INDX
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          3328K
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ))
/

