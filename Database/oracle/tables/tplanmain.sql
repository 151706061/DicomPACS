DROP TABLE ASU.TPLANMAIN CASCADE CONSTRAINTS
/

--
-- TPLANMAIN  (Table) 
--
CREATE TABLE ASU.TPLANMAIN
(
  FK_ID      NUMBER(15),
  FK_PLANID  NUMBER(15),
  FK_KORPID  NUMBER(15),
  FN_KDN     NUMBER(15),
  FC_NAME    VARCHAR2(60 BYTE),
  FN_COUNT   NUMBER(15)
)
TABLESPACE USR
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          520K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING
/

COMMENT ON TABLE ASU.TPLANMAIN IS 'графики заездов по корпусам by TimurLan [just 4 blue gorka]'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FK_ID IS 'SEQUENCE=[SEQ_TPLANMAIN]'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FK_PLANID IS 'TPLAN.FK_ID'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FK_KORPID IS 'TKORP.FK_ID'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FN_KDN IS 'количество дней'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FC_NAME IS 'название'
/

COMMENT ON COLUMN ASU.TPLANMAIN.FN_COUNT IS 'количество путевок'
/


--
-- TPLANMAIN_DELETE_ALL  (Trigger) 
--
--  Dependencies: 
--   TPLANMAIN (Table)
--
CREATE OR REPLACE TRIGGER ASU."TPLANMAIN_DELETE_ALL" 
AFTER DELETE
ON ASU.TPLANMAIN REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
Begin
  Delete from TPLANSLAVE where FK_MAINID = :OLD.FK_ID;
end;
/
SHOW ERRORS;


--
-- TPLANMAIN_BEFORE_INSERT  (Trigger) 
--
--  Dependencies: 
--   TPLANMAIN (Table)
--
CREATE OR REPLACE TRIGGER ASU."TPLANMAIN_BEFORE_INSERT" 
BEFORE INSERT
ON ASU.TPLANMAIN REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
Begin
  SELECT SEQ_TPLANMAIN.NEXTVAL INTO :NEW.FK_ID FROM DUAL;
End;
/
SHOW ERRORS;


