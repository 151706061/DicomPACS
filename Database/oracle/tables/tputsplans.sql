ALTER TABLE ASU.TPUTSPLANS
 DROP PRIMARY KEY CASCADE
/

DROP TABLE ASU.TPUTSPLANS CASCADE CONSTRAINTS
/

--
-- TPUTSPLANS  (Table) 
--
CREATE TABLE ASU.TPUTSPLANS
(
  FK_ID          NUMBER(15)                     NOT NULL,
  FK_LISTID      NUMBER(15),
  FK_TYPEID      NUMBER(15),
  FC_NUM         VARCHAR2(15 BYTE),
  FN_KDN         NUMBER(15),
  FL_NEW         NUMBER(1)                      DEFAULT 1,
  FL_USED        NUMBER(1)                      DEFAULT 0,
  FK_PACID       NUMBER(15)                     DEFAULT -1,
  FK_KORPID      NUMBER(15)                     DEFAULT -1,
  FK_TYPEKURSID  NUMBER
)
TABLESPACE USR
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          160K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING
/

COMMENT ON TABLE ASU.TPUTSPLANS IS 'справочник планируемых путевок by TimurLan'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_ID IS 'SEQUENCE=[SEQ_TPUTSPLANS]'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_LISTID IS 'TPUTPLANLIST.FK_ID'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_TYPEID IS 'тип путевки'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FC_NUM IS 'номер путевки - надо уменьшить с 30 до 15 ???'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FN_KDN IS 'к-во дней'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FL_NEW IS 'признак "новая'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FL_USED IS 'признак "погашена'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_PACID IS 'код пациента'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_KORPID IS 'код корпуса'
/

COMMENT ON COLUMN ASU.TPUTSPLANS.FK_TYPEKURSID IS 'ссылка на курс'
/


--
-- TPUTSPLANS_BY_ID  (Index) 
--
--  Dependencies: 
--   TPUTSPLANS (Table)
--
CREATE UNIQUE INDEX ASU.TPUTSPLANS_BY_ID ON ASU.TPUTSPLANS
(FK_ID)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          128K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- TPUTSPLANS_DELETE_ALL  (Trigger) 
--
--  Dependencies: 
--   TPUTSPLANS (Table)
--
CREATE OR REPLACE TRIGGER ASU."TPUTSPLANS_DELETE_ALL" 
AFTER DELETE
ON ASU.TPUTSPLANS REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
Begin
 Delete from TPUTPLANDATA where FK_PUTID=:OLD.FK_ID;
end;
/
SHOW ERRORS;


--
-- TPUTSPLANS_BEFORE_INSERT  (Trigger) 
--
--  Dependencies: 
--   TPUTSPLANS (Table)
--
CREATE OR REPLACE TRIGGER ASU."TPUTSPLANS_BEFORE_INSERT" 
BEFORE INSERT
ON ASU.TPUTSPLANS REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
Begin
  SELECT SEQ_TPutsplans.NEXTVAL INTO :NEW.FK_ID FROM DUAL;
End;
/
SHOW ERRORS;


-- 
-- Non Foreign Key Constraints for Table TPUTSPLANS 
-- 
ALTER TABLE ASU.TPUTSPLANS ADD (
  CONSTRAINT TPUTSPLANS_BY_ID
 PRIMARY KEY
 (FK_ID)
    USING INDEX 
    TABLESPACE INDX
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          128K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ))
/

GRANT DELETE, INSERT, SELECT, UPDATE ON ASU.TPUTSPLANS TO BUH
/

