ALTER TABLE ASU.TSTANDART_TIPROOM
 DROP PRIMARY KEY CASCADE
/

DROP TABLE ASU.TSTANDART_TIPROOM CASCADE CONSTRAINTS
/

--
-- TSTANDART_TIPROOM  (Table) 
--
--  Dependencies: 
--   TSTANDART (Table)
--   TTIPROOM (Table)
--
CREATE TABLE ASU.TSTANDART_TIPROOM
(
  FK_ID        NUMBER(6)                        NOT NULL,
  FK_STANDART  INTEGER,
  FK_TIPROOM   INTEGER                          NOT NULL
)
TABLESPACE USR
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          16K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOLOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING
/

COMMENT ON TABLE ASU.TSTANDART_TIPROOM IS 'Связь стандарта лечения с типом койки TSTANDART и  TTIPROOM
Author: Efimov'
/

COMMENT ON COLUMN ASU.TSTANDART_TIPROOM.FK_ID IS 'SEQUENCE=[SEQ_STANDART_TIPROOM]'
/


--
-- IQ_TSTANDART_TIPROOM$ALL  (Index) 
--
--  Dependencies: 
--   TSTANDART_TIPROOM (Table)
--
CREATE INDEX ASU.IQ_TSTANDART_TIPROOM$ALL ON ASU.TSTANDART_TIPROOM
(FK_STANDART, FK_TIPROOM)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          704K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- PK_TSTANDART_TIPROOM  (Index) 
--
--  Dependencies: 
--   TSTANDART_TIPROOM (Table)
--
CREATE UNIQUE INDEX ASU.PK_TSTANDART_TIPROOM ON ASU.TSTANDART_TIPROOM
(FK_ID)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          448K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- TSTANDART_TIPROOM_TIPROOM  (Index) 
--
--  Dependencies: 
--   TSTANDART_TIPROOM (Table)
--
CREATE INDEX ASU.TSTANDART_TIPROOM_TIPROOM ON ASU.TSTANDART_TIPROOM
(FK_TIPROOM)
NOLOGGING
TABLESPACE INDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          512K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
/


--
-- TSTANDART_TIPROOM$BI  (Trigger) 
--
--  Dependencies: 
--   TSTANDART_TIPROOM (Table)
--
CREATE OR REPLACE TRIGGER ASU."TSTANDART_TIPROOM$BI" before insert
on ASU.TSTANDART_TIPROOM for each row
begin
    --  Column "FK_ID" uses sequence SEQ_STANDART_TIPROOM
    if :new.FK_ID is null then
      select SEQ_STANDART_TIPROOM.NEXTVAL INTO :new.FK_ID  from dual;
    end if;
end;
/
SHOW ERRORS;


-- 
-- Non Foreign Key Constraints for Table TSTANDART_TIPROOM 
-- 
ALTER TABLE ASU.TSTANDART_TIPROOM ADD (
  CONSTRAINT PK_TSTANDART_TIPROOM
 PRIMARY KEY
 (FK_ID)
    USING INDEX 
    TABLESPACE INDX
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          448K
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ))
/

-- 
-- Foreign Key Constraints for Table TSTANDART_TIPROOM 
-- 
ALTER TABLE ASU.TSTANDART_TIPROOM ADD (
  CONSTRAINT FK_TSTANDART_TIPROOM_ST 
 FOREIGN KEY (FK_STANDART) 
 REFERENCES ASU.TSTANDART (FK_ID)
    ON DELETE CASCADE,
  CONSTRAINT FK_TSTANDART_TIPROOM_TR 
 FOREIGN KEY (FK_TIPROOM) 
 REFERENCES ASU.TTIPROOM (FK_ID)
    ON DELETE CASCADE)
/

GRANT DELETE, INDEX, INSERT, REFERENCES, SELECT, UPDATE ON ASU.TSTANDART_TIPROOM TO EXCHANGE
/

GRANT DELETE, INDEX, INSERT, REFERENCES, SELECT, UPDATE ON ASU.TSTANDART_TIPROOM TO EXCH43
/

